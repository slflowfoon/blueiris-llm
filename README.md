# blueiris-llm

## How It Works
1. When a camera is alerted, Blue Iris writes the path to the most recent alert image on the camera to `latest.txt`
2. It then runs the `run.bat` script which reads the value of the `img_path` from `latest.txt` and runs the Python script using the most recent `img_path`
3. After the LLM responds, the Python script extracts the response from the JSON to `response.txt`
4. Blue Iris then sends the response in the body of the notification by using the additional special macros

## Installation

The way that I run this is by placing the following 2 files in a folder named after the camera, for example, `C:\Users\MyUser\Documents\Blue Iris\Driveway\`:
  * `__init__.py`
  * `run.bat`

1. In Blue Iris, create the following action on alert:
   * **Action:** `Write to file--replace`
   * **File:** `C:\Users\MyUser\Documents\Blue Iris\Driveway\latest.txt`
   * **Parameters:** `D:\Your\Alert\Images\Directory\&ALERT_PATH`
   * **Camera:** Choose the camera your are setting up, for example, `Driveway`
     
![](https://github.com/slflowfoon/blueiris-llm/blob/main/images/Notification%201.png?raw=true)

2. Create another action on alert:
   * **Action:** `Run program/script`
   * **File:** `C:\Users\MyUser\Documents\Blue Iris\Driveway\run.bat`
     
![](https://github.com/slflowfoon/blueiris-llm/blob/main/images/Notification%202.png?raw=true)

3. Create a delay of `5000msec` to give the script and the LLM enough time to respond.
   
![](https://github.com/slflowfoon/blueiris-llm/blob/main/images/Notification%203.png?raw=true)

5. Create your push notification:
   * **Body:** `%1`
     
![](https://github.com/slflowfoon/blueiris-llm/blob/main/images/Notification%204.png?raw=true)

5. Within **Blue Iris Settings** > **Macros**, we'll setup `%1` to the `response.txt` file generated by the script.
   * **%1:** `file://C:\Users\MyUser\Documents\Blue Iris\Driveway\response.txt`
     
![](https://github.com/slflowfoon/blueiris-llm/blob/main/images/Macro%20Settings.png?raw=true)

## Debugging

Logs are saved in the same directory as the `.bat` script under `logs.txt`

----
